require(["helper","admin/feedbackStream"],function(e,t){var n=function(){this.getNewRow(this),this.events(this)};n.prototype.events=function(e){},n.prototype.eventsRefresh=function(n){var r,i;$(".js-option-input-name, .js-option-input-value").off("keypress.option").on("keypress.option",function(e){i=this,clearTimeout(r),r=setTimeout(function(){n.changeInput(n,i)},500)}),$(".js-delete").on("click.option",function(n){n.preventDefault();var r=$(this),i=r.closest(".js-option"),s=i.attr("data-id");$.ajax({url:e.urlBase("admin/ajax/option/delete/"),type:"get",dataType:"json",data:{id:s},complete:function(e){},success:function(e){e&&i.remove()},error:function(e){t.createMessage({message:"Network error.",type:"negative"})}})})},n.prototype.changeInput=function(n,r){var i=$(r),s=i.closest(".js-option"),o=s.find(".js-option-input-name"),u=s.find(".js-option-input-value"),a=s.attr("data-id");o.off("change.option"),u.off("change.option"),$.ajax({url:e.urlBase("admin/ajax/option/"+(a?a:"create")+"/"),type:"get",dataType:"json",data:{name:o.val(),value:u.val()},complete:function(e){n.getNewRow(n)},success:function(e){s.attr("data-id",e.id),n.eventsRefresh(n)},error:function(e){t.createMessage({message:"Network error.",type:"negative"})}})},n.prototype.getNewRow=function(e){var t=$(".js-option"),n=!0;for(var r=t.length-1;r>=0;r--)$(t[r]).attr("data-id")||(n=!1);n&&(t.last().clone().attr("data-id","").appendTo(".js-options tbody"),option=$(".js-option").last(),option.find(".js-option-input-name").val(""),option.find(".js-option-input-value").val(""),e.eventsRefresh(e))};var r=new n});